{
  "$defs": {
    "EventType": {
      "description": "Types of changes that can be logged.",
      "enum": [
        "field_update",
        "field_add",
        "field_remove",
        "relationship_add",
        "relationship_remove",
        "relationship_update",
        "status_change",
        "entity_create",
        "entity_archive",
        "entity_restore",
        "confidence_update",
        "verification"
      ],
      "title": "EventType",
      "type": "string"
    },
    "FieldChange": {
      "description": "A single field change within an event.",
      "properties": {
        "field": {
          "description": "Field path that changed (e.g., 'role', '$relationships')",
          "title": "Field",
          "type": "string"
        },
        "operation": {
          "description": "Operation performed: set, append, remove, update",
          "examples": [
            "set",
            "append",
            "remove",
            "update"
          ],
          "title": "Operation",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {},
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "New value (for set/append) or removed value (for remove)",
          "title": "Value"
        },
        "old_value": {
          "anyOf": [
            {},
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Previous value (for audit trail)",
          "title": "Old Value"
        }
      },
      "required": [
        "field",
        "operation"
      ],
      "title": "FieldChange",
      "type": "object"
    }
  },
  "description": "An immutable record of a change to an entity.\n\nEvents are append-only and enable:\n- Full audit trail\n- Point-in-time reconstruction\n- Change attribution",
  "examples": [
    {
      "actor": "system/daily_context",
      "changes": [
        {
          "field": "current_focus",
          "operation": "set",
          "value": "Leading 4 squads across Good Chop, TPT, Factor Form"
        }
      ],
      "correlation_id": "context-2026-01-21",
      "event_id": "evt-2026-01-21-001",
      "timestamp": "2026-01-21T13:20:00Z",
      "type": "field_update"
    }
  ],
  "properties": {
    "event_id": {
      "description": "Unique event identifier",
      "title": "Event Id",
      "type": "string"
    },
    "timestamp": {
      "description": "When the change occurred (UTC)",
      "format": "date-time",
      "title": "Timestamp",
      "type": "string"
    },
    "type": {
      "$ref": "#/$defs/EventType",
      "description": "Type of change"
    },
    "actor": {
      "description": "Who/what made the change (e.g., 'user/nikita', 'system/daily_context')",
      "examples": [
        "user/nikita",
        "system/daily_context",
        "sync/jira",
        "sync/github"
      ],
      "title": "Actor",
      "type": "string"
    },
    "changes": {
      "description": "List of field changes in this event",
      "items": {
        "$ref": "#/$defs/FieldChange"
      },
      "title": "Changes",
      "type": "array"
    },
    "correlation_id": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "ID to correlate related events (e.g., 'context-2026-01-21')",
      "title": "Correlation Id"
    },
    "source": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Source system or document that triggered this change",
      "examples": [
        "jira:PROJ-123",
        "gdoc:1abc2def",
        "slack:C123ABC"
      ],
      "title": "Source"
    },
    "message": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Human-readable description of the change",
      "title": "Message"
    }
  },
  "required": [
    "type",
    "actor"
  ],
  "title": "ChangeEvent",
  "type": "object"
}