---
$schema: brain://entity/project/v1
$id: entity/project/drr-2026-01-12-pm-os-30-architecture
$type: project
$version: 1
$created: '2026-01-22T08:31:01.825440Z'
$updated: '2026-01-30T15:14:17.137899'
$confidence: 0.36
$source: unknown
$status: active
$relationships:
- type: mentioned_in
  target: nikita
  confidence: 0.65
  source: body_extraction
  last_verified: '2026-01-30'
$tags: []
$aliases: []
$events:
- event_id: evt-migration-20260122
  timestamp: '2026-01-22T08:31:01.825440Z'
  type: entity_create
  actor: system/schema_migrator
  changes:
  - field: $schema
    operation: set
    value: brain://entity/project/v1
  message: Migrated from v1 to v2 schema
name: Drr 2026 01 12 Pm Os 3.0 Architecture
---

# Design Rationale Record: PM-OS 3.0 Architecture

**DRR ID:** DRR-2026-01-12-pm-os-3.0-architecture
**Date:** 2026-01-12
**Status:** Approved
**Decision Maker:** Nikita Gorshkov
**FPF Session:** pm-os-3-0-refactor

---

## 1. Bounded Context

**Decision Question:** Should we approve the PM-OS 3.0 architecture that separates LOGIC (distributable code) from CONTENT (user-specific data)?

**Scope:**
- Directory structure: Two git repos in parent folder
- Configuration: config.yaml + .env separation
- Path resolution: Multi-strategy bootstrap
- Entity schemas: Type-based validation
- Migration: /update-3.0 and /revert-2.4 commands

**Constraints:**
- Must not break v2.4 until user explicitly migrates
- Must support revert to v2.4 at any time
- Must work cross-platform (Mac/Linux/Windows)
- Must work with both Claude and Gemini CLI

---

## 2. Hypotheses Considered (Abduction)

### H1: Two Separate Git Repos (SELECTED)
```
pm-os/
├── common/  → hellofresh/hf-pm-os (LOGIC)
└── user/    → user's repo (CONTENT)
```
**Pros:**
- Clear separation of concerns
- LOGIC can be versioned and updated independently
- User's CONTENT stays in their existing repo
- No submodule complexity

**Cons:**
- Requires coordinated updates
- Path resolution complexity

### H2: Git Submodule
```
Documents/
└── .pm-os/  → git submodule to hf-pm-os
```
**Pros:**
- Single repo for user
- Atomic updates

**Cons:**
- Submodule complexity (users often struggle)
- Merge conflicts on LOGIC updates
- .gitmodules management

### H3: Package Distribution (pip install)
```
pip install hf-pm-os
```
**Pros:**
- Standard Python distribution
- Version pinning

**Cons:**
- Doesn't work well with markdown commands
- Can't easily customize LOGIC
- Contribution workflow complicated

### H4: Monorepo with .gitignore
```
Documents/
├── .pm-os-logic/  → gitignored, copied on update
└── [user content]
```
**Pros:**
- Simple mental model
- Single directory

**Cons:**
- No git history for LOGIC
- Manual update process
- Can't contribute back easily

---

## 3. Logical Verification (Deduction)

### Architecture Consistency Checks

| Check | H1 (Two Repos) | Result |
|-------|----------------|--------|
| Commands can find tools | Via $PM_OS_COMMON env var | PASS |
| Tools can find config | Via path_resolver.py | PASS |
| User can update LOGIC | git pull in common/ | PASS |
| User can contribute | Fork + PR to hf-pm-os | PASS |
| Revert works | Snapshot + restore | PASS |
| Cross-platform | .sh + .ps1 scripts | PASS |
| Multi-CLI | Same commands, same tools | PASS |

### Breaking Change Analysis

| Scenario | Impact | Mitigation |
|----------|--------|------------|
| User runs old command | Works (v2.4 intact) | No breaking change |
| User runs /update-3.0 | Guided migration | Explicit opt-in |
| Migration fails | /revert-2.4 available | Full rollback |
| Tool path changes | Config-driven | Fallback to legacy |

---

## 4. Evidence (Induction)

### E1: Discovery Analysis
**Source:** `DISCOVERY_FINDINGS.md`
**Reliability:** CL3 (same context, internal analysis)
**Finding:** 147 files classified - clear LOGIC/CONTENT separation possible
- 53 Claude commands (LOGIC)
- 24 Gemini commands (LOGIC)
- 61 Python tools (LOGIC)
- 276 Brain entities (CONTENT)
- 5 HYBRID files (require split strategy)

### E2: Similar Architecture Precedent
**Source:** VSCode extensions, Oh-My-Zsh, Homebrew
**Reliability:** CL2 (similar context)
**Finding:** Successful projects use repo-based LOGIC distribution with user config overlay

### E3: User Workflow Analysis
**Source:** Current PM-OS usage patterns
**Reliability:** CL3 (same context)
**Finding:**
- Users don't modify LOGIC (commands, tools)
- Users heavily modify CONTENT (Brain, context)
- Clear separation enables independent updates

### E4: Migration Risk Assessment
**Source:** `ARCHITECTURE_update_revert.md`
**Reliability:** CL3 (same context)
**Finding:**
- Snapshot before migration ensures safety
- Step-by-step migration with validation
- Revert available at any point

---

## 5. Trust Calculus (WLNK)

| Evidence | Reliability | Weight |
|----------|-------------|--------|
| E1: Discovery Analysis | 0.95 (CL3) | 1.0 |
| E2: Precedent | 0.75 (CL2) | 0.8 |
| E3: Workflow Analysis | 0.90 (CL3) | 1.0 |
| E4: Risk Assessment | 0.85 (CL3) | 0.9 |

**WLNK (Weakest Link):** 0.75 (E2 - external precedent)

**Effective Reliability:** 0.75

**Interpretation:** Architecture is sound with high confidence from internal analysis. External precedent provides additional support but at lower confidence level.

---

## 6. Decision

**APPROVED:** PM-OS 3.0 Architecture as designed in ARCHITECTURE_*.md files.

**Key Architecture Elements:**
1. **Two-Repo Structure:** `pm-os/common/` (LOGIC) + `pm-os/user/` (CONTENT)
2. **Config Split:** config.yaml (settings) + .env (secrets)
3. **Path Resolution:** ENV → marker → global config → infer
4. **Entity Schemas:** Type-based validation with additionalProperties allowed
5. **Migration:** /update-3.0 with snapshot + /revert-2.4 for rollback

**Conditions:**
- Implementation must include all error handling as specified
- Cross-platform scripts (sh + ps1) required
- Revert capability must be tested before release

---

## 7. Consequences

### Positive
- Clean separation enables independent LOGIC updates
- Users can contribute to PM-OS via standard PR workflow
- Revert capability reduces migration risk
- Config-driven approach enables customization

### Negative
- Initial setup complexity (two repos)
- Path resolution adds runtime overhead
- Users must learn new directory structure

### Risks to Monitor
- Path resolution failures on edge-case systems
- Config version drift between LOGIC and CONTENT
- User confusion during transition period

---

## 8. Related Documents

- `DISCOVERY_FINDINGS.md` - File classification
- `ARCHITECTURE_config_yaml.md` - Config schema
- `ARCHITECTURE_path_resolution.md` - Path bootstrap
- `ARCHITECTURE_update_revert.md` - Migration flow
- `ARCHITECTURE_entity_schemas.md` - Entity types

---

*Generated: 2026-01-12*
*Session: pm-os-3-0-refactor*
*FPF Effective Reliability: 0.75*
